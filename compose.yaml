services:
    gateway:
        build: .
        restart: unless-stopped
        ports:
            - "80:80"
            - "443:443"
        volumes:
            - ./conf.d:/etc/nginx/conf.d:ro
            - ./lua:/usr/local/openresty/nginx/conf/lua:ro
            - resty-auto-ssl:/etc/resty-auto-ssl
        networks:
            - sumber-network
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost/health"]
            interval: 30s
            timeout: 10s
            retries: 3
            start_period: 40s
        environment:
            - TZ=UTC

networks:
    sumber-network:
        external: true

volumes:
    resty-auto-ssl:
